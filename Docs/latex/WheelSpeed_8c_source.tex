\doxysection{Wheel\+Speed.\+c}
\hypertarget{WheelSpeed_8c_source}{}\label{WheelSpeed_8c_source}\index{Src/Sensors/DigitalSensors/WheelSpeed.c@{Src/Sensors/DigitalSensors/WheelSpeed.c}}
\mbox{\hyperlink{WheelSpeed_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ "{}../../../includes/WheelSpeed.h"{}}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}../../../includes/TimeUtils.h"{}}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00003}00003\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00004}00004\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00006}00006\ \textcolor{preprocessor}{\#ifndef\ M\_PI}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00007}\mbox{\hyperlink{WheelSpeed_8c_ae71449b1cc6e6250b91f539153a7a0d3}{00007}}\ \textcolor{preprocessor}{\#define\ M\_PI\ 3.14159265358979323846}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00008}00008\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00010}00010\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00011}00011\ \textcolor{comment}{\ *\ Initialization\ function\ for\ a\ wheel\ speed\ sensor.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00012}00012\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00013}00013\ \textcolor{comment}{\ *\ @param\ ws\ A\ pointer\ to\ the\ WheelSpeed\ structure.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00014}00014\ \textcolor{comment}{\ *\ @pram\ hz\ Rate\ at\ which\ the\ sensor\ is\ called\ (in\ hz).}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00015}00015\ \textcolor{comment}{\ *\ @pram\ port\ Location\ of\ sensor.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00016}00016\ \textcolor{comment}{\ *\ @pram\ radius\ Radius\ of\ wheel\ (in\ mm).}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00017}00017\ \textcolor{comment}{\ *\ @pram\ numTeeth\ Number\ of\ teeth\ on\ reluctor\ wheel.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00018}00018\ \textcolor{comment}{\ *\ @pram\ location\ Location\ of\ sensor\ on\ car.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00019}00019\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00020}\mbox{\hyperlink{WheelSpeed_8h_ac49732714bcdc5c6bb1c4f94ddf497b3}{00020}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{WheelSpeed_8c_ac49732714bcdc5c6bb1c4f94ddf497b3}{initWheelSpeed}}(\mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*\ ws,\ \textcolor{keywordtype}{int}\ hz,\ \textcolor{keywordtype}{int}\ port,\ \textcolor{keywordtype}{float}\ radius,\ \textcolor{keywordtype}{int}\ numTeeth,}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00021}00021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{WheelLocation_8h_a6bcc31f28038e411321704f9947331d7}{WHEEL\_LOCATION}}\ location)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00022}00022\ \ \ \ \ \mbox{\hyperlink{DigitalSensor_8h_a2bf0b31c332d3808de755eb6bf35b3c5}{initDigitalSensor}}(\&ws-\/>\mbox{\hyperlink{structWheelSpeed_ac9ad06f7e5816697f4bfea770b9722b2}{base}},\ \textcolor{stringliteral}{"{}Wheel\ Speed"{}},\ hz,\ port);}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00023}00023\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_ac9ad06f7e5816697f4bfea770b9722b2}{base}}.\mbox{\hyperlink{structDigitalSensor_aa5cfba5a7ccb124822fa1d8a2aac9ece}{sensor}}.\mbox{\hyperlink{structSensor_a7e6cf7138f6d350fd2bf0a76fba7a2ad}{updateable}}.\mbox{\hyperlink{structUpdateable_a16ae43b8576f63634cc825a7294c7a78}{update}}\ =\ \mbox{\hyperlink{WheelSpeed_8c_a92ea112da554d5de8a6b9204fa30381a}{updateWheelSpeed}};}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00024}00024\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_aa54a56855e20fb6bdc11ae0db9b0e5aa}{radius}}\ =\ radius;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00025}00025\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a1fd60e20c5451a8c92a570b56a28cfb6}{wheel\_location}}\ =\ location;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00026}00026\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_acca8266f1bc14244ade0afb42cf5a1d5}{numTeeth}}\ =\ numTeeth;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00027}00027\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a9797aef29f050455eddc81891a4278a3}{pulses}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00028}00028\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a6d8b62cdae99f0980adf213fe71558e1}{speed}}\ =\ 0.0f;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00029}00029\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a454f0d96c91e9ddd41b215873fdef473}{interval}}\ =\ \mbox{\hyperlink{TimeUtils_8h_aee85a3385434e4615f588684cb7c5aca}{getCurrentTime}}();}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00030}00030\ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00032}00032\ \textcolor{comment}{//\ TODO:\ Perhaps\ add\ class\ for\ conversions.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00033}\mbox{\hyperlink{WheelSpeed_8c_a1ef4d5caa02f110202636d49b785a58a}{00033}}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{WheelSpeed_8c_a1ef4d5caa02f110202636d49b785a58a}{MPS\_TO\_MPH}}\ =\ 2.236936;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00041}\mbox{\hyperlink{WheelSpeed_8c_afc7e7aa256276c3574cb19108257cfc8}{00041}}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{WheelSpeed_8c_afc7e7aa256276c3574cb19108257cfc8}{convertMpsToMph}}(\textcolor{keywordtype}{float}\ metersPerSecond)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00042}00042\ \ \ \ \ \textcolor{keywordflow}{return}\ metersPerSecond\ *\ \mbox{\hyperlink{WheelSpeed_8c_a1ef4d5caa02f110202636d49b785a58a}{MPS\_TO\_MPH}};}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00043}00043\ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00051}\mbox{\hyperlink{WheelSpeed_8h_a9b06a45c350af910e0b84912802616b9}{00051}}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{WheelSpeed_8c_a9b06a45c350af910e0b84912802616b9}{calculateSpeed}}(\mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*\ ws)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00052}00052\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ pointer\ is\ null}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00053}00053\ \ \ \ \ \textcolor{keywordflow}{if}\ (ws\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00054}00054\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Error:\ Null\ pointer\ passed\ to\ calculateSpeed\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00055}00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ Or\ handle\ the\ error\ as\ appropriate}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00056}00056\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00058}00058\ \ \ \ \ \textcolor{keywordtype}{int}\ numTeeth\ =\ ws-\/>\mbox{\hyperlink{structWheelSpeed_acca8266f1bc14244ade0afb42cf5a1d5}{numTeeth}};}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00059}00059\ \ \ \ \ \textcolor{keywordtype}{float}\ radius\ =\ ws-\/>\mbox{\hyperlink{structWheelSpeed_aa54a56855e20fb6bdc11ae0db9b0e5aa}{radius}};}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00060}00060\ \ \ \ \ \textcolor{keywordtype}{int}\ pulses\ =\ ws-\/>\mbox{\hyperlink{structWheelSpeed_a9797aef29f050455eddc81891a4278a3}{pulses}};}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00061}00061\ \ \ \ \ \textcolor{keywordtype}{float}\ delta\ =\ \mbox{\hyperlink{TimeUtils_8h_ab811d2f5aa3466ef464b7e2a8ff6c31d}{measureInterval}}(ws-\/>\mbox{\hyperlink{structWheelSpeed_a454f0d96c91e9ddd41b215873fdef473}{interval}});}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00063}00063\ \ \ \ \ \textcolor{comment}{//\ Reset\ pulse\ count\ and\ elapsed\ time\ for\ the\ next\ measurement\ interval}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00064}00064\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a454f0d96c91e9ddd41b215873fdef473}{interval}}\ =\ \mbox{\hyperlink{TimeUtils_8h_aee85a3385434e4615f588684cb7c5aca}{getCurrentTime}}();}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00065}00065\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a9797aef29f050455eddc81891a4278a3}{pulses}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00067}00067\ \ \ \ \ \textcolor{comment}{//\ Verify\ inputs}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00068}00068\ \ \ \ \ \textcolor{keywordflow}{if}\ (numTeeth\ <=\ 0\ ||\ radius\ <=\ 0.0f\ ||\ pulses\ <=\ 0\ ||\ delta\ <=\ 0.0)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00069}00069\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error:\ Invalid\ argument.\ "{}}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}NumTeeth\ =\ \%d,\ Radius\ =\ \%.2f,\ Pulses\ =\ \%d,\ Time\ Delta\ =\ \%.2f\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ numTeeth,\ radius,\ pulses,\ delta);}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0f;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00073}00073\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00075}00075\ \ \ \ \ \textcolor{comment}{//\ Calculations}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00076}00076\ \ \ \ \ \textcolor{keywordtype}{float}\ circumference\ =\ 2\ *\ \mbox{\hyperlink{WheelSpeed_8c_ae71449b1cc6e6250b91f539153a7a0d3}{M\_PI}}\ *\ radius;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00077}00077\ \ \ \ \ \textcolor{keywordtype}{float}\ distancePerPulse\ =\ circumference\ /\ numTeeth;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00078}00078\ \ \ \ \ \textcolor{keywordtype}{float}\ speedMetersPerSecond\ =\ (distancePerPulse\ *\ pulses)\ /\ delta;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00079}00079\ \ \ \ \ \textcolor{keywordtype}{float}\ speed\ =\ \mbox{\hyperlink{WheelSpeed_8c_afc7e7aa256276c3574cb19108257cfc8}{convertMpsToMph}}(speedMetersPerSecond);}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{return}\ speed;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00082}00082\ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00084}00084\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00085}00085\ \textcolor{comment}{\ *\ Updated\ the\ speed\ var\ in\ this\ sensor.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00086}00086\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00087}00087\ \textcolor{comment}{\ *\ @param\ ws\ A\ pointer\ to\ the\ WheelSpeed\ structure.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00088}00088\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00089}\mbox{\hyperlink{WheelSpeed_8h_a92ea112da554d5de8a6b9204fa30381a}{00089}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{WheelSpeed_8c_a92ea112da554d5de8a6b9204fa30381a}{updateWheelSpeed}}(\textcolor{keywordtype}{void}*\ ws)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00090}00090\ \ \ \ \ \mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*\ wsPtr\ =\ (\mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*)ws;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00091}00091\ \ \ \ \ wsPtr-\/>\mbox{\hyperlink{structWheelSpeed_a6d8b62cdae99f0980adf213fe71558e1}{speed}}\ =\ \mbox{\hyperlink{WheelSpeed_8c_a9b06a45c350af910e0b84912802616b9}{calculateSpeed}}(ws);}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00092}00092\ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00095}00095\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00096}00096\ \textcolor{comment}{\ *\ Add\ pulses\ to\ sensor;}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00097}00097\ \textcolor{comment}{\ *\ For\ testing\ and\ debugging.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00098}00098\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00099}00099\ \textcolor{comment}{\ *\ @param\ ws\ A\ pointer\ to\ the\ WheelSpeed\ structure.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00100}00100\ \textcolor{comment}{\ *\ @param\ num\ Number\ of\ pulses\ to\ add.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00101}00101\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00102}\mbox{\hyperlink{WheelSpeed_8h_a27cf8300dac12d235a50cf77b9f9aaac}{00102}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{WheelSpeed_8c_abfbed5b438cb45d5327460b0f4006fb6}{addPulse}}(\mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*\ ws,\ \textcolor{keywordtype}{int}\ num)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00103}00103\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a9797aef29f050455eddc81891a4278a3}{pulses}}\ +=\ num;}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00104}00104\ \}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00106}00106\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00107}00107\ \textcolor{comment}{\ *\ Set\ time\ interval.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00108}00108\ \textcolor{comment}{\ *\ For\ testing\ and\ debugging.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00109}00109\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00110}00110\ \textcolor{comment}{\ *\ @param\ ws\ A\ pointer\ to\ the\ WheelSpeed\ structure.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00111}00111\ \textcolor{comment}{\ *\ @param\ interval\ Time\ interval\ to\ set.}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00112}00112\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00113}\mbox{\hyperlink{WheelSpeed_8h_a8a44c706d5c92c453cfbd4e7be159c36}{00113}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{WheelSpeed_8c_a8a44c706d5c92c453cfbd4e7be159c36}{setTimeInterval}}(\mbox{\hyperlink{structWheelSpeed}{WheelSpeed}}*\ ws,\ \textcolor{keywordtype}{float}\ interval)\ \{}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00114}00114\ \ \ \ \ ws-\/>\mbox{\hyperlink{structWheelSpeed_a454f0d96c91e9ddd41b215873fdef473}{interval}}\ =\ interval\ +\ \mbox{\hyperlink{TimeUtils_8h_aee85a3385434e4615f588684cb7c5aca}{getCurrentTime}}();}
\DoxyCodeLine{\Hypertarget{WheelSpeed_8c_source_l00115}00115\ \}}

\end{DoxyCode}
